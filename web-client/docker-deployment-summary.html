<!doctype html>
<html>
  <head>
    <title>Dockerå®¹å™¨åŒ–éƒ¨ç½²æ€»ç»“</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        line-height: 1.6;
      }
      .success {
        color: green;
      }
      .info {
        color: blue;
      }
      .warning {
        color: orange;
      }
      h1,
      h2 {
        color: #333;
      }
      .code-block {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
      }
      .file-block {
        background: #e8f4f8;
        padding: 8px;
        margin: 5px 0;
        border-radius: 4px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
        margin: 15px 0;
      }
      .card {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²å®ç°å®Œæˆ</h1>

    <h2>ğŸ“¦ Dockeré…ç½®æ–‡ä»¶</h2>
    <div class="grid">
      <div class="card">
        <h3>ğŸ—ï¸ ç”Ÿäº§ç¯å¢ƒ</h3>
        <div class="file-block">ğŸ“„ Dockerfile - å¤šé˜¶æ®µç”Ÿäº§æ„å»º</div>
        <div class="file-block">ğŸ“„ nginx.conf - Nginxä¸»é…ç½®</div>
        <div class="file-block">ğŸ“„ nginx.default.conf - è™šæ‹Ÿä¸»æœºé…ç½®</div>
        <div class="file-block">ğŸ“„ docker-entrypoint.sh - å®¹å™¨å¯åŠ¨è„šæœ¬</div>
      </div>
      <div class="card">
        <h3>ğŸ› ï¸ å¼€å‘ç¯å¢ƒ</h3>
        <div class="file-block">ğŸ“„ Dockerfile.dev - å¼€å‘ç¯å¢ƒæ„å»º</div>
        <div class="file-block">ğŸ“„ docker-compose.dev.yml - å¼€å‘æœåŠ¡ç¼–æ’</div>
        <div class="file-block">ğŸ“„ .dockerignore - æ„å»ºå¿½ç•¥æ–‡ä»¶</div>
      </div>
    </div>

    <h2>ğŸ­ ç”Ÿäº§ç¯å¢ƒç‰¹æ€§</h2>
    <div class="grid">
      <div class="card">
        <h3>ğŸ”§ æ„å»ºä¼˜åŒ–</h3>
        <ul>
          <li class="success">âœ… å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å°</li>
          <li class="success">âœ… Alpine LinuxåŸºç¡€é•œåƒ</li>
          <li class="success">âœ… érootç”¨æˆ·è¿è¡Œ</li>
          <li class="success">âœ… å®‰å…¨é…ç½®å’Œæƒé™æ§åˆ¶</li>
          <li class="success">âœ… å¥åº·æ£€æŸ¥æœºåˆ¶</li>
        </ul>
      </div>
      <div class="card">
        <h3>ğŸŒ Nginxé…ç½®</h3>
        <ul>
          <li>Gzipå‹ç¼©ä¼˜åŒ–</li>
          <li>é™æ€èµ„æºç¼“å­˜ç­–ç•¥</li>
          <li>å®‰å…¨å¤´é…ç½®</li>
          <li>SPAè·¯ç”±æ”¯æŒ</li>
          <li>APIä»£ç†é¢„ç•™</li>
          <li>PWAæ”¯æŒé…ç½®</li>
        </ul>
      </div>
    </div>

    <h2>âš™ï¸ å®¹å™¨é…ç½®è¯¦æƒ…</h2>

    <h3>ğŸ“‹ åŸºç¡€é…ç½®</h3>
    <div class="code-block">
      # åŸºç¡€é•œåƒï¼šnginx:alpine # å·¥ä½œç«¯å£ï¼š8080 # è¿è¡Œç”¨æˆ·ï¼šappuser (éroot) #
      å¥åº·æ£€æŸ¥ï¼š/healthç«¯ç‚¹ # é‡å¯ç­–ç•¥ï¼šunless-stopped
    </div>

    <h3>ğŸ” å®‰å…¨ç‰¹æ€§</h3>
    <ul>
      <li><strong>érootç”¨æˆ·è¿è¡Œ</strong> - ä½¿ç”¨appuser:appgroup</li>
      <li>
        <strong>å®‰å…¨å¤´é…ç½®</strong> - X-Frame-Options, X-Content-Type-Optionsç­‰
      </li>
      <li><strong>éšè—æœåŠ¡å™¨ä¿¡æ¯</strong> - server_tokens off</li>
      <li><strong>æ–‡ä»¶æƒé™æ§åˆ¶</strong> - æœ€å°æƒé™åŸåˆ™</li>
      <li><strong>å†…å®¹å®‰å…¨ç­–ç•¥</strong> - CSPå¤´é…ç½®</li>
    </ul>

    <h3>ğŸš€ æ€§èƒ½ä¼˜åŒ–</h3>
    <ul>
      <li><strong>Gzipå‹ç¼©</strong> - æ–‡æœ¬æ–‡ä»¶å‹ç¼©æ¯”6çº§</li>
      <li><strong>é™æ€èµ„æºç¼“å­˜</strong> - 1å¹´ç¼“å­˜æœŸ</li>
      <li><strong>Nginxä¼˜åŒ–</strong> - workeré…ç½®å’Œè¿æ¥ä¼˜åŒ–</li>
      <li><strong>é•œåƒå±‚ä¼˜åŒ–</strong> - å¤šé˜¶æ®µæ„å»ºå‡å°‘å¤§å°</li>
    </ul>

    <h2>ğŸ› ï¸ å¼€å‘ç¯å¢ƒæ”¯æŒ</h2>
    <div class="grid">
      <div class="card">
        <h3>ğŸ”„ çƒ­é‡è½½å¼€å‘</h3>
        <ul>
          <li>æºä»£ç å·æŒ‚è½½</li>
          <li>Vite HMRæ”¯æŒ</li>
          <li>å¼€å‘ä¾èµ–å®Œæ•´å®‰è£…</li>
          <li>è°ƒè¯•å·¥å…·é›†æˆ</li>
        </ul>
      </div>
      <div class="card">
        <h3>ğŸ§ª è¾…åŠ©æœåŠ¡</h3>
        <ul>
          <li>Mock APIæœåŠ¡å™¨</li>
          <li>PostgreSQLæ•°æ®åº“</li>
          <li>Redisç¼“å­˜</li>
          <li>MinIOå¯¹è±¡å­˜å‚¨</li>
          <li>MailHogé‚®ä»¶æµ‹è¯•</li>
        </ul>
      </div>
    </div>

    <h2>ğŸ“Š Docker Composeç¼–æ’</h2>

    <h3>ğŸ­ ç”Ÿäº§ç¯å¢ƒ (docker-compose.yml)</h3>
    <div class="code-block">
      services: web-client: # ä¸»åº”ç”¨æœåŠ¡ nginx-proxy: # åå‘ä»£ç† (å¯é€‰) redis: #
      ç¼“å­˜æœåŠ¡ (å¯é€‰) prometheus: # ç›‘æ§æœåŠ¡ (å¯é€‰) grafana: # å¯è§†åŒ–ç›‘æ§ (å¯é€‰)
    </div>

    <h3>ğŸ› ï¸ å¼€å‘ç¯å¢ƒ (docker-compose.dev.yml)</h3>
    <div class="code-block">
      services: web-client-dev: # å¼€å‘æœåŠ¡ mock-api: # Mock API postgres-dev: #
      å¼€å‘æ•°æ®åº“ redis-dev: # å¼€å‘ç¼“å­˜ minio: # å¯¹è±¡å­˜å‚¨ mailhog: # é‚®ä»¶æµ‹è¯•
    </div>

    <h2>ğŸ”§ æ„å»ºå’Œè¿è¡Œè„šæœ¬</h2>

    <h3>ğŸ“ æ„å»ºè„šæœ¬ (scripts/docker-build.sh)</h3>
    <ul>
      <li class="success">âœ… å¤šå¹³å°æ„å»ºæ”¯æŒ (AMD64/ARM64)</li>
      <li class="success">âœ… å®‰å…¨æ‰«æé›†æˆ (Trivy)</li>
      <li class="success">âœ… é•œåƒæ¨é€è‡ªåŠ¨åŒ–</li>
      <li class="success">âœ… æ„å»ºå‚æ•°åŒ–é…ç½®</li>
      <li class="success">âœ… æ—§é•œåƒæ¸…ç†åŠŸèƒ½</li>
    </ul>

    <h3>ğŸƒ è¿è¡Œè„šæœ¬ (scripts/docker-run.sh)</h3>
    <ul>
      <li class="success">âœ… ç”Ÿäº§/å¼€å‘æ¨¡å¼åˆ‡æ¢</li>
      <li class="success">âœ… å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</li>
      <li class="success">âœ… æ—¥å¿—æŸ¥çœ‹å’Œè°ƒè¯•</li>
      <li class="success">âœ… å¥åº·æ£€æŸ¥ç›‘æ§</li>
      <li class="success">âœ… èµ„æºä½¿ç”¨ç»Ÿè®¡</li>
    </ul>

    <h2>ğŸ’» ä½¿ç”¨å‘½ä»¤</h2>

    <h3>ğŸ—ï¸ æ„å»ºå‘½ä»¤</h3>
    <div class="code-block">
      # NPMè„šæœ¬ npm run docker:build # æ„å»ºç”Ÿäº§é•œåƒ npm run docker:build:dev #
      æ„å»ºå¼€å‘é•œåƒ # ç›´æ¥è„šæœ¬ ./scripts/docker-build.sh # é»˜è®¤æ„å»º
      ./scripts/docker-build.sh -t v1.0.0 -p # æ„å»ºå¹¶æ¨é€
      ./scripts/docker-build.sh -m -p # å¤šå¹³å°æ„å»ºæ¨é€ ./scripts/docker-build.sh
      -s # æ„å»ºå¹¶å®‰å…¨æ‰«æ
    </div>

    <h3>ğŸƒ è¿è¡Œå‘½ä»¤</h3>
    <div class="code-block">
      # NPMè„šæœ¬ npm run docker:run # è¿è¡Œç”Ÿäº§å®¹å™¨ npm run docker:dev #
      è¿è¡Œå¼€å‘å®¹å™¨ npm run docker:stop # åœæ­¢å®¹å™¨ npm run docker:logs # æŸ¥çœ‹æ—¥å¿—
      npm run docker:clean # æ¸…ç†å®¹å™¨ # ç›´æ¥è„šæœ¬ ./scripts/docker-run.sh run #
      è¿è¡Œå®¹å™¨ ./scripts/docker-run.sh dev # å¼€å‘æ¨¡å¼ ./scripts/docker-run.sh
      logs # æŸ¥çœ‹æ—¥å¿— ./scripts/docker-run.sh shell # è¿›å…¥å®¹å™¨
      ./scripts/docker-run.sh status # æŸ¥çœ‹çŠ¶æ€
    </div>

    <h3>ğŸ­ Docker Composeå‘½ä»¤</h3>
    <div class="code-block">
      # ç”Ÿäº§ç¯å¢ƒ docker-compose up -d # å¯åŠ¨æ‰€æœ‰æœåŠ¡ docker-compose up
      web-client # ä»…å¯åŠ¨ä¸»æœåŠ¡ docker-compose --profile monitoring up #
      å¯åŠ¨ç›‘æ§æœåŠ¡ # å¼€å‘ç¯å¢ƒ docker-compose -f docker-compose.dev.yml up -d
      docker-compose -f docker-compose.dev.yml --profile database up
      docker-compose -f docker-compose.dev.yml logs -f web-client-dev
    </div>

    <h2>ğŸŒ ç¯å¢ƒå˜é‡é…ç½®</h2>
    <div class="code-block">
      # åº”ç”¨é…ç½® API_BASE_URL=http://localhost:8080/api # APIæœåŠ¡åœ°å€
      WS_BASE_URL=ws://localhost:8080/ws # WebSocketåœ°å€ APP_VERSION=1.0.0 #
      åº”ç”¨ç‰ˆæœ¬ ENVIRONMENT=production # ç¯å¢ƒç±»å‹ # Dockeré…ç½®
      DOCKER_REGISTRY=myregistry.com # é•œåƒä»“åº“ DOCKER_TAG=latest # é•œåƒæ ‡ç­¾
      HOST_PORT=8080 # ä¸»æœºç«¯å£ # ç›‘æ§é…ç½® GRAFANA_PASSWORD=admin # Grafanaå¯†ç 
    </div>

    <h2>ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—</h2>
    <div class="grid">
      <div class="card">
        <h3>ğŸ” å¥åº·æ£€æŸ¥</h3>
        <ul>
          <li>HTTPå¥åº·æ£€æŸ¥ç«¯ç‚¹: /health</li>
          <li>30ç§’æ£€æŸ¥é—´éš”</li>
          <li>3æ¬¡é‡è¯•æœºåˆ¶</li>
          <li>10ç§’è¶…æ—¶è®¾ç½®</li>
        </ul>
      </div>
      <div class="card">
        <h3>ğŸ“Š ç›‘æ§é›†æˆ</h3>
        <ul>
          <li>PrometheusæŒ‡æ ‡æ”¶é›†</li>
          <li>Grafanaå¯è§†åŒ–é¢æ¿</li>
          <li>å®¹å™¨èµ„æºç›‘æ§</li>
          <li>åº”ç”¨æ€§èƒ½æŒ‡æ ‡</li>
        </ul>
      </div>
    </div>

    <h2>ğŸš€ éƒ¨ç½²æµç¨‹</h2>

    <h3>1ï¸âƒ£ æœ¬åœ°å¼€å‘</h3>
    <div class="code-block">
      # 1. æ„å»ºå¼€å‘é•œåƒ npm run docker:build:dev # 2. è¿è¡Œå¼€å‘ç¯å¢ƒ npm run
      docker:dev # 3. æŸ¥çœ‹åº”ç”¨: http://localhost:3000
    </div>

    <h3>2ï¸âƒ£ ç”Ÿäº§éƒ¨ç½²</h3>
    <div class="code-block">
      # 1. æ„å»ºç”Ÿäº§é•œåƒ npm run docker:build # 2. è¿è¡Œç”Ÿäº§å®¹å™¨ npm run
      docker:run # 3. æŸ¥çœ‹åº”ç”¨: http://localhost:8080
    </div>

    <h3>3ï¸âƒ£ é›†ç¾¤éƒ¨ç½²</h3>
    <div class="code-block">
      # 1. æ¨é€åˆ°é•œåƒä»“åº“ docker tag three-kingdoms-web-client:latest
      myregistry.com/three-kingdoms:v1.0.0 docker push
      myregistry.com/three-kingdoms:v1.0.0 # 2. ä½¿ç”¨Docker Compose
      docker-compose up -d # 3. ä½¿ç”¨Kubernetes kubectl apply -f k8s/
    </div>

    <h2>ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ</h2>
    <ul>
      <li class="success">âœ… érootç”¨æˆ·è¿è¡Œ</li>
      <li class="success">âœ… æœ€å°æƒé™åŸåˆ™</li>
      <li class="success">âœ… å®‰å…¨åŸºç¡€é•œåƒ</li>
      <li class="success">âœ… å®šæœŸå®‰å…¨æ‰«æ</li>
      <li class="success">âœ… ç§˜å¯†ç®¡ç†å¤–éƒ¨åŒ–</li>
      <li class="success">âœ… ç½‘ç»œå®‰å…¨é…ç½®</li>
      <li class="success">âœ… æ—¥å¿—å®¡è®¡åŠŸèƒ½</li>
    </ul>

    <h2>âš¡ æ€§èƒ½ä¼˜åŒ–</h2>
    <ul>
      <li><strong>é•œåƒå±‚ä¼˜åŒ–</strong> - å‡å°‘å±‚æ•°å’Œå¤§å°</li>
      <li><strong>é™æ€èµ„æºç¼“å­˜</strong> - é•¿æœŸç¼“å­˜ç­–ç•¥</li>
      <li><strong>Gzipå‹ç¼©</strong> - å‡å°‘ä¼ è¾“å¤§å°</li>
      <li><strong>å¥åº·æ£€æŸ¥ä¼˜åŒ–</strong> - åˆç†çš„æ£€æŸ¥é—´éš”</li>
      <li><strong>èµ„æºé™åˆ¶</strong> - CPUå’Œå†…å­˜é™åˆ¶</li>
      <li><strong>ç½‘ç»œä¼˜åŒ–</strong> - è¿æ¥æ± å’ŒKeep-Alive</li>
    </ul>

    <h2>ğŸ“‹ å¾…åŠäº‹é¡¹</h2>
    <div class="warning">
      <h3>ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š</h3>
      <ul>
        <li>æµ‹è¯•Dockeræ„å»ºå’Œè¿è¡Œ</li>
        <li>é…ç½®CI/CDé›†æˆ</li>
        <li>è®¾ç½®ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</li>
        <li>é…ç½®ç›‘æ§å‘Šè­¦</li>
        <li>å®æ–½å®‰å…¨æ‰«æ</li>
        <li>æ€§èƒ½åŸºå‡†æµ‹è¯•</li>
        <li>ç¾éš¾æ¢å¤è®¡åˆ’</li>
      </ul>
    </div>

    <p class="info">
      <strong>æ³¨æ„ï¼š</strong> é¦–æ¬¡ä½¿ç”¨éœ€è¦ç¡®ä¿Dockerå·²å®‰è£…å¹¶è¿è¡Œã€‚
      ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¯·æµ‹è¯•æ‰€æœ‰é…ç½®å¹¶æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ç¯å¢ƒå˜é‡ã€‚
    </p>

    <h2>ğŸ¯ éƒ¨ç½²æ¶æ„å›¾</h2>
    <div class="code-block">
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Load
      Balancer â”‚â”€â”€â”€â”€â”‚ Nginx Proxy â”‚â”€â”€â”€â”€â”‚ Web Client â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ (Container) â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Static Files â”‚ â”‚ (Nginx Cache) â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    </div>
  </body>
</html>
