<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡æˆå°±ç³»ç»ŸåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { 
            font-family: 'Microsoft YaHei', Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
        }
        .test-section { 
            border: 1px solid #444; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
        }
        .success { color: #4caf50; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
        .loading { color: #ff9800; }
        .info { color: #2196f3; }
        button { 
            padding: 12px 20px; 
            margin: 8px; 
            cursor: pointer; 
            border: none;
            border-radius: 6px;
            background: linear-gradient(45deg, #ff6b35, #f9ca24);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        button:hover { 
            background: linear-gradient(45deg, #ff8c42, #f9d71c);
            transform: translateY(-1px);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        h1 { 
            text-align: center; 
            color: #ff6b35; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }
        h3 { color: #ff6b35; border-bottom: 2px solid #ff6b35; padding-bottom: 5px; }
        
        .navigation {
            text-align: center;
            margin: 20px 0;
        }
        .nav-link {
            color: #ff6b35;
            text-decoration: none;
            margin: 0 15px;
            padding: 8px 16px;
            border: 1px solid #ff6b35;
            border-radius: 4px;
            display: inline-block;
            transition: all 0.3s;
        }
        .nav-link:hover {
            background: rgba(255,107,53,0.2);
        }
        
        input, select {
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            color: white;
            padding: 8px;
            border-radius: 4px;
            margin: 5px;
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ff6b35;
        }
        
        .quest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .quest-card {
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .quest-card:hover {
            border-color: #ff6b35;
            background: rgba(255,107,53,0.1);
        }
        
        .quest-card.daily { border-left: 4px solid #4caf50; }
        .quest-card.weekly { border-left: 4px solid #2196f3; }
        .quest-card.main { border-left: 4px solid #ff9800; }
        .quest-card.achievement { border-left: 4px solid #9c27b0; }
        
        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .quest-name {
            font-weight: bold;
            color: #ff6b35;
            font-size: 16px;
        }
        
        .quest-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .quest-status.not_started { background: #666; }
        .quest-status.in_progress { background: #ff9800; }
        .quest-status.completed { background: #4caf50; }
        .quest-status.claimed { background: #2196f3; }
        
        .quest-description {
            color: #ccc;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .quest-progress {
            margin: 10px 0;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #f9ca24);
            transition: width 0.3s;
        }
        
        .quest-rewards {
            background: rgba(255,107,53,0.1);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .quest-rewards .reward-item {
            display: inline-block;
            margin: 2px 5px;
            padding: 2px 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            font-size: 12px;
        }
        
        .achievement-card {
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }
        
        .achievement-card.combat { border-left: 4px solid #f44336; }
        .achievement-card.collection { border-left: 4px solid #4caf50; }
        .achievement-card.progression { border-left: 4px solid #2196f3; }
        .achievement-card.social { border-left: 4px solid #ff9800; }
        .achievement-card.special { border-left: 4px solid #9c27b0; }
        
        .achievement-rarity {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .achievement-rarity.common { background: #9e9e9e; }
        .achievement-rarity.rare { background: #4caf50; }
        .achievement-rarity.epic { background: #9c27b0; }
        .achievement-rarity.legendary { background: #ff9800; }
        .achievement-rarity.mythic { background: #f44336; }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: rgba(255,107,53,0.2);
            border-color: #ff6b35;
        }
        
        .tab.active {
            background: rgba(255,107,53,0.3);
            border-color: #ff6b35;
            color: #ff6b35;
        }
        
        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(255,107,53,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ff6b35;
        }
        
        .stat-label {
            font-size: 12px;
            color: #ccc;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>ä¸‰å›½è‹±é›„ä¼  - ä»»åŠ¡æˆå°±ç³»ç»Ÿæµ‹è¯• ğŸ†</h1>
    
    <div class="navigation">
        <a href="http://localhost:3000" class="nav-link" target="_blank">ğŸ® å‰ç«¯åº”ç”¨</a>
        <a href="test-shop-system.html" class="nav-link">ğŸ›’ å•†åº—æµ‹è¯•</a>
        <a href="test-equipment-system.html" class="nav-link">ğŸ›¡ï¸ è£…å¤‡æµ‹è¯•</a>
        <a href="test-hero-cultivation.html" class="nav-link">âš”ï¸ åŸ¹å…»æµ‹è¯•</a>
    </div>

    <div class="test-section">
        <h3>1. è®¤è¯ç™»å½•</h3>
        <button onclick="testAuth()">ğŸ” ç™»å½•è·å–Token</button>
        <div id="auth-result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. ä»»åŠ¡ç³»ç»Ÿ</h3>
        
        <div class="tabs" id="quest-tabs">
            <div class="tab active" data-category="daily">ğŸ“… æ¯æ—¥ä»»åŠ¡</div>
            <div class="tab" data-category="weekly">ğŸ“† å‘¨å¸¸ä»»åŠ¡</div>
            <div class="tab" data-category="main">ğŸ“œ ä¸»çº¿ä»»åŠ¡</div>
            <div class="tab" data-category="side">ğŸ—‚ï¸ æ”¯çº¿ä»»åŠ¡</div>
            <div class="tab" data-category="all">ğŸŒŸ å…¨éƒ¨ä»»åŠ¡</div>
        </div>
        
        <div class="info">
            <button onclick="loadQuests(currentQuestCategory)">ğŸ“‹ åŠ è½½ä»»åŠ¡åˆ—è¡¨</button>
            <button onclick="loadDailyQuests()">ğŸ“… åŠ è½½æ¯æ—¥ä»»åŠ¡</button>
            <button onclick="refreshDailyQuests()">ğŸ”„ åˆ·æ–°æ¯æ—¥ä»»åŠ¡</button>
        </div>
        
        <div id="quest-info"></div>
        <div id="quest-list" class="quest-grid">
            <!-- ä»»åŠ¡åˆ—è¡¨å°†é€šè¿‡JavaScriptæ˜¾ç¤º -->
        </div>
    </div>

    <div class="test-section">
        <h3>3. æˆå°±ç³»ç»Ÿ</h3>
        
        <div class="tabs" id="achievement-tabs">
            <div class="tab active" data-category="all">ğŸ† å…¨éƒ¨æˆå°±</div>
            <div class="tab" data-category="combat">âš”ï¸ æˆ˜æ–—æˆå°±</div>
            <div class="tab" data-category="collection">ğŸ“¦ æ”¶é›†æˆå°±</div>
            <div class="tab" data-category="progression">ğŸ“ˆ è¿›åº¦æˆå°±</div>
            <div class="tab" data-category="social">ğŸ‘¥ ç¤¾äº¤æˆå°±</div>
        </div>
        
        <div class="info">
            <button onclick="loadAchievements(currentAchievementCategory)">ğŸ† åŠ è½½æˆå°±åˆ—è¡¨</button>
            <button onclick="loadAchievementStatistics()">ğŸ“Š åŠ è½½æˆå°±ç»Ÿè®¡</button>
        </div>
        
        <div id="achievement-statistics" class="statistics-grid">
            <!-- æˆå°±ç»Ÿè®¡å°†é€šè¿‡JavaScriptæ˜¾ç¤º -->
        </div>
        
        <div id="achievement-list" class="quest-grid">
            <!-- æˆå°±åˆ—è¡¨å°†é€šè¿‡JavaScriptæ˜¾ç¤º -->
        </div>
    </div>

    <div class="test-section">
        <h3>4. è¿›åº¦æ¨¡æ‹Ÿæµ‹è¯•</h3>
        
        <h4>ğŸ“Š ä»»åŠ¡è¿›åº¦æ›´æ–°</h4>
        <div class="form-group">
            <label>ä»»åŠ¡ID:</label>
            <input type="text" id="questId" placeholder="è¾“å…¥ä»»åŠ¡ID" value="daily_battle">
        </div>
        
        <div class="form-group">
            <label>åŠ¨ä½œç±»å‹:</label>
            <select id="questAction">
                <option value="battles_completed">å®Œæˆæˆ˜æ–—</option>
                <option value="hero_upgrades">æ­¦å°†å‡çº§</option>
                <option value="arena_battles">ç«æŠ€åœºæˆ˜æ–—</option>
                <option value="equipment_enhancements">è£…å¤‡å¼ºåŒ–</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>è¿›åº¦å€¼:</label>
            <input type="number" id="questValue" placeholder="è¿›åº¦å¢åŠ å€¼" value="1" min="1">
        </div>
        
        <button onclick="testUpdateQuestProgress()">ğŸ“ˆ æ›´æ–°ä»»åŠ¡è¿›åº¦</button>
        <div id="quest-progress-result"></div>
        
        <h4>ğŸ† æˆå°±è¿›åº¦æ›´æ–°</h4>
        <div class="form-group">
            <label>æˆå°±ID:</label>
            <input type="text" id="achievementId" placeholder="è¾“å…¥æˆå°±ID" value="first_victory">
        </div>
        
        <div class="form-group">
            <label>åŠ¨ä½œç±»å‹:</label>
            <select id="achievementAction">
                <option value="battles_won">èµ¢å¾—æˆ˜æ–—</option>
                <option value="unique_heroes">æ”¶é›†æ­¦å°†</option>
                <option value="friends_count">æ·»åŠ å¥½å‹</option>
                <option value="guild_joined">åŠ å…¥å…¬ä¼š</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>è¿›åº¦å€¼:</label>
            <input type="number" id="achievementValue" placeholder="è¿›åº¦å¢åŠ å€¼" value="1" min="1">
        </div>
        
        <button onclick="testUpdateAchievementProgress()">ğŸ¯ æ›´æ–°æˆå°±è¿›åº¦</button>
        <div id="achievement-progress-result"></div>
    </div>

    <div class="test-section">
        <h3>5. å¥–åŠ±é¢†å–æµ‹è¯•</h3>
        
        <div class="form-group">
            <label>ä»»åŠ¡å¥–åŠ±é¢†å–:</label>
            <input type="text" id="rewardQuestId" placeholder="è¾“å…¥ä»»åŠ¡ID" value="daily_battle">
            <button onclick="testClaimQuestReward()">ğŸ’° é¢†å–ä»»åŠ¡å¥–åŠ±</button>
        </div>
        
        <div class="form-group">
            <label>æˆå°±å¥–åŠ±é¢†å–:</label>
            <input type="text" id="rewardAchievementId" placeholder="è¾“å…¥æˆå°±ID" value="first_victory">
            <button onclick="testClaimAchievementReward()">ğŸ é¢†å–æˆå°±å¥–åŠ±</button>
        </div>
        
        <div id="reward-result"></div>
    </div>

    <div class="test-section">
        <h3>6. ç³»ç»ŸéªŒè¯</h3>
        <div class="info">
            <p>ğŸ¯ <strong>ä»»åŠ¡æˆå°±ç³»ç»Ÿæµ‹è¯•è¦ç‚¹ï¼š</strong></p>
            <ul>
                <li>éªŒè¯ä»»åŠ¡åˆ›å»ºï¼šæ¯æ—¥ä»»åŠ¡è‡ªåŠ¨ç”Ÿæˆå’Œé‡ç½®</li>
                <li>éªŒè¯è¿›åº¦è¿½è¸ªï¼šä»»åŠ¡å’Œæˆå°±è¿›åº¦æ­£ç¡®æ›´æ–°</li>
                <li>éªŒè¯å®Œæˆæ£€æµ‹ï¼šè¾¾åˆ°æ¡ä»¶æ—¶è‡ªåŠ¨æ ‡è®°å®Œæˆ</li>
                <li>éªŒè¯å¥–åŠ±ç³»ç»Ÿï¼šæ­£ç¡®å‘æ”¾ä»»åŠ¡å’Œæˆå°±å¥–åŠ±</li>
                <li>éªŒè¯åˆ†çº§æˆå°±ï¼šå¤šå±‚çº§æˆå°±è¿›åº¦è®¡ç®—æ­£ç¡®</li>
                <li>éªŒè¯ç»Ÿè®¡åŠŸèƒ½ï¼šæˆå°±å®Œæˆç‡å’Œç§¯åˆ†ç»Ÿè®¡å‡†ç¡®</li>
            </ul>
        </div>
        <button onclick="window.open('http://localhost:3000', '_blank')">ğŸš€ æ‰“å¼€å‰ç«¯æµ‹è¯•</button>
    </div>

    <script>
        const API_BASE = 'http://localhost:1337/api';
        let authToken = null;
        let currentQuestCategory = 'daily';
        let currentAchievementCategory = 'all';

        // è®¤è¯
        async function testAuth() {
            const resultDiv = document.getElementById('auth-result');
            resultDiv.innerHTML = '<span class="loading">ğŸ”„ æ­£åœ¨ç™»å½•...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        identifier: 'pengcl',
                        password: 'zouleyuan',
                        rememberMe: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.data.token) {
                    authToken = data.data.token;
                    resultDiv.innerHTML = `
                        <span class="success">âœ… ç™»å½•æˆåŠŸ</span>
                        <div>ç”¨æˆ·: ${data.data.user.username} | Token: ${authToken.substring(0, 20)}...</div>
                    `;
                    
                    // è‡ªåŠ¨åŠ è½½æ¯æ—¥ä»»åŠ¡
                    setTimeout(() => loadDailyQuests(), 500);
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ç™»å½•å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        // æ ‡ç­¾åˆ‡æ¢äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // ä»»åŠ¡æ ‡ç­¾åˆ‡æ¢
            const questTabs = document.querySelectorAll('#quest-tabs .tab');
            questTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    questTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentQuestCategory = this.dataset.category;
                    loadQuests(currentQuestCategory);
                });
            });

            // æˆå°±æ ‡ç­¾åˆ‡æ¢
            const achievementTabs = document.querySelectorAll('#achievement-tabs .tab');
            achievementTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    achievementTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentAchievementCategory = this.dataset.category;
                    loadAchievements(currentAchievementCategory);
                });
            });
        });

        // åŠ è½½ä»»åŠ¡åˆ—è¡¨
        async function loadQuests(category = 'all') {
            const questListDiv = document.getElementById('quest-list');
            
            if (!authToken) {
                questListDiv.innerHTML = '<div class="error">âŒ è¯·å…ˆç™»å½•</div>';
                return;
            }
            
            questListDiv.innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨åŠ è½½ä»»åŠ¡...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/quests?category=${category}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayQuests(data.data.quests);
                } else {
                    questListDiv.innerHTML = `<div class="error">âŒ åŠ è½½å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                questListDiv.innerHTML = `<div class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }

        // åŠ è½½æ¯æ—¥ä»»åŠ¡
        async function loadDailyQuests() {
            const questListDiv = document.getElementById('quest-list');
            const questInfoDiv = document.getElementById('quest-info');
            
            if (!authToken) {
                questListDiv.innerHTML = '<div class="error">âŒ è¯·å…ˆç™»å½•</div>';
                return;
            }
            
            questListDiv.innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨åŠ è½½æ¯æ—¥ä»»åŠ¡...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/quests/daily`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    questInfoDiv.innerHTML = `
                        <div class="info">
                            <h4>ğŸ“… æ¯æ—¥ä»»åŠ¡æ¦‚è§ˆ</h4>
                            <p><strong>å®Œæˆè¿›åº¦:</strong> ${data.data.summary.completed}/${data.data.summary.total}</p>
                            <p><strong>é‡ç½®æ—¶é—´:</strong> ${data.data.resetTime}</p>
                            ${data.data.summary.canClaimAll ? '<p style="color: #4caf50;"><strong>ğŸ‰ å¯é¢†å–å…¨éƒ¨å®Œæˆå¥–åŠ±ï¼</strong></p>' : ''}
                        </div>
                    `;
                    displayQuests(data.data.quests);
                } else {
                    questListDiv.innerHTML = `<div class="error">âŒ åŠ è½½å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                questListDiv.innerHTML = `<div class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }

        // æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨
        function displayQuests(quests) {
            const questListDiv = document.getElementById('quest-list');
            
            if (quests.length === 0) {
                questListDiv.innerHTML = '<div class="info">ğŸ“­ æš‚æ— ä»»åŠ¡</div>';
                return;
            }
            
            questListDiv.innerHTML = quests.map(quest => {
                const progressEntries = Object.entries(quest.progress);
                const targetEntries = Object.entries(quest.targetValues);
                
                // è®¡ç®—æ€»è¿›åº¦ç™¾åˆ†æ¯”
                let totalProgress = 0;
                let totalTarget = 0;
                targetEntries.forEach(([key, target]) => {
                    totalProgress += Math.min(quest.progress[key] || 0, target);
                    totalTarget += target;
                });
                const progressPercentage = totalTarget > 0 ? (totalProgress / totalTarget * 100) : 0;
                
                return `
                    <div class="quest-card ${quest.category}">
                        <div class="quest-header">
                            <div class="quest-name">${quest.name}</div>
                            <div class="quest-status ${quest.status}">${getStatusText(quest.status)}</div>
                        </div>
                        <div class="quest-description">${quest.description}</div>
                        
                        <div class="quest-progress">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <span style="font-size: 12px; color: #ccc;">è¿›åº¦</span>
                                <span style="font-size: 12px; color: #ff6b35;">${progressPercentage.toFixed(1)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                            </div>
                            <div style="font-size: 12px; color: #ccc; margin-top: 5px;">
                                ${targetEntries.map(([key, target]) => 
                                    `${key}: ${quest.progress[key] || 0}/${target}`
                                ).join(' | ')}
                            </div>
                        </div>
                        
                        <div class="quest-rewards">
                            <strong>ğŸ å¥–åŠ±:</strong>
                            ${Object.entries(quest.rewards).map(([type, amount]) => 
                                `<span class="reward-item">${getRewardName(type)}: ${amount}</span>`
                            ).join('')}
                        </div>
                        
                        <div style="margin-top: 15px;">
                            ${quest.canClaim ? 
                                `<button onclick="claimQuestReward('${quest.questId}')" style="background: #4caf50;">ğŸ’° é¢†å–å¥–åŠ±</button>` :
                                `<button onclick="updateQuestProgress('${quest.questId}')" ${quest.status === 'claimed' ? 'disabled' : ''}>
                                    ğŸ“ˆ æ¨¡æ‹Ÿè¿›åº¦
                                </button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åŠ è½½æˆå°±åˆ—è¡¨
        async function loadAchievements(category = 'all') {
            const achievementListDiv = document.getElementById('achievement-list');
            
            if (!authToken) {
                achievementListDiv.innerHTML = '<div class="error">âŒ è¯·å…ˆç™»å½•</div>';
                return;
            }
            
            achievementListDiv.innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨åŠ è½½æˆå°±...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/achievements?category=${category}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayAchievements(data.data.achievements);
                } else {
                    achievementListDiv.innerHTML = `<div class="error">âŒ åŠ è½½å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                achievementListDiv.innerHTML = `<div class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }

        // æ˜¾ç¤ºæˆå°±åˆ—è¡¨
        function displayAchievements(achievements) {
            const achievementListDiv = document.getElementById('achievement-list');
            
            if (achievements.length === 0) {
                achievementListDiv.innerHTML = '<div class="info">ğŸ† æš‚æ— æˆå°±</div>';
                return;
            }
            
            achievementListDiv.innerHTML = achievements.map(achievement => `
                <div class="achievement-card ${achievement.category}">
                    <div class="quest-header">
                        <div class="quest-name">
                            ${achievement.name}
                            <span class="achievement-rarity ${achievement.rarity}">${achievement.rarity}</span>
                        </div>
                        <div class="quest-status ${achievement.status}">${getStatusText(achievement.status)}</div>
                    </div>
                    <div class="quest-description">${achievement.description}</div>
                    
                    <div class="quest-progress">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="font-size: 12px; color: #ccc;">å®Œæˆåº¦</span>
                            <span style="font-size: 12px; color: #ff6b35;">${achievement.progressPercentage.toFixed(1)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${achievement.progressPercentage}%"></div>
                        </div>
                        ${achievement.type === 'tiered' ? 
                            `<div style="font-size: 12px; color: #ccc; margin-top: 5px;">
                                å±‚çº§: ${achievement.currentTier}/${achievement.maxTier}
                            </div>` : ''
                        }
                    </div>
                    
                    <div class="quest-rewards">
                        <strong>ğŸ† å¥–åŠ± (${achievement.points}ç§¯åˆ†):</strong>
                        ${Object.entries(achievement.rewards).map(([type, amount]) => 
                            `<span class="reward-item">${getRewardName(type)}: ${amount}</span>`
                        ).join('')}
                    </div>
                    
                    <div style="margin-top: 15px;">
                        ${achievement.canClaim ? 
                            `<button onclick="claimAchievementReward('${achievement.achievementId}')" style="background: #4caf50;">ğŸ é¢†å–å¥–åŠ±</button>` :
                            `<button onclick="updateAchievementProgress('${achievement.achievementId}')" ${achievement.status === 'claimed' ? 'disabled' : ''}>
                                ğŸ¯ æ¨¡æ‹Ÿè¿›åº¦
                            </button>`
                        }
                    </div>
                </div>
            `).join('');
        }

        // åŠ è½½æˆå°±ç»Ÿè®¡
        async function loadAchievementStatistics() {
            const statisticsDiv = document.getElementById('achievement-statistics');
            
            if (!authToken) {
                statisticsDiv.innerHTML = '<div class="error">âŒ è¯·å…ˆç™»å½•</div>';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/achievements/statistics`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.data;
                    statisticsDiv.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-value">${stats.totalAchievements}</div>
                            <div class="stat-label">æ€»æˆå°±æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.completedAchievements}</div>
                            <div class="stat-label">å·²å®Œæˆ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.completionPercentage}%</div>
                            <div class="stat-label">å®Œæˆç‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${stats.totalPoints}</div>
                            <div class="stat-label">æ€»ç§¯åˆ†</div>
                        </div>
                    `;
                } else {
                    statisticsDiv.innerHTML = `<div class="error">âŒ åŠ è½½å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                statisticsDiv.innerHTML = `<div class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }

        // æ›´æ–°ä»»åŠ¡è¿›åº¦
        async function testUpdateQuestProgress() {
            const questId = document.getElementById('questId').value;
            const action = document.getElementById('questAction').value;
            const value = parseInt(document.getElementById('questValue').value) || 1;
            const resultDiv = document.getElementById('quest-progress-result');
            
            if (!questId || !authToken) {
                resultDiv.innerHTML = '<span class="error">âŒ è¯·è¾“å…¥ä»»åŠ¡IDå¹¶ç™»å½•</span>';
                return;
            }
            
            resultDiv.innerHTML = '<span class="loading">ğŸ”„ æ­£åœ¨æ›´æ–°è¿›åº¦...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/quests/progress`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ questId, action, value })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">âœ… è¿›åº¦æ›´æ–°æˆåŠŸï¼</div>
                        <div><strong>ä»»åŠ¡:</strong> ${data.data.questId}</div>
                        <div><strong>çŠ¶æ€:</strong> ${getStatusText(data.data.status)}</div>
                        <div><strong>æ˜¯å¦å®Œæˆ:</strong> ${data.data.completed ? 'æ˜¯' : 'å¦'}</div>
                    `;
                    
                    // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
                    if (currentQuestCategory === 'daily') {
                        loadDailyQuests();
                    } else {
                        loadQuests(currentQuestCategory);
                    }
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æ›´æ–°å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        // æ›´æ–°æˆå°±è¿›åº¦
        async function testUpdateAchievementProgress() {
            const achievementId = document.getElementById('achievementId').value;
            const action = document.getElementById('achievementAction').value;
            const value = parseInt(document.getElementById('achievementValue').value) || 1;
            const resultDiv = document.getElementById('achievement-progress-result');
            
            if (!achievementId || !authToken) {
                resultDiv.innerHTML = '<span class="error">âŒ è¯·è¾“å…¥æˆå°±IDå¹¶ç™»å½•</span>';
                return;
            }
            
            resultDiv.innerHTML = '<span class="loading">ğŸ”„ æ­£åœ¨æ›´æ–°è¿›åº¦...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/achievements/progress`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ achievementId, action, value })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">âœ… æˆå°±è¿›åº¦æ›´æ–°æˆåŠŸï¼</div>
                        <div><strong>æˆå°±:</strong> ${data.data.achievementId}</div>
                        <div><strong>çŠ¶æ€:</strong> ${getStatusText(data.data.status)}</div>
                        <div><strong>è¿›åº¦:</strong> ${data.data.progressPercentage.toFixed(1)}%</div>
                        <div><strong>å½“å‰å±‚çº§:</strong> ${data.data.currentTier}</div>
                        ${data.data.newlyCompleted ? '<div style="color: #4caf50;"><strong>ğŸ‰ æ–°å®Œæˆæˆå°±ï¼</strong></div>' : ''}
                    `;
                    
                    // åˆ·æ–°æˆå°±åˆ—è¡¨
                    loadAchievements(currentAchievementCategory);
                    loadAchievementStatistics();
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æ›´æ–°å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        // é¢†å–ä»»åŠ¡å¥–åŠ±
        async function testClaimQuestReward() {
            const questId = document.getElementById('rewardQuestId').value;
            await claimQuestReward(questId);
        }

        async function claimQuestReward(questId) {
            const resultDiv = document.getElementById('reward-result');
            
            if (!questId || !authToken) {
                resultDiv.innerHTML = '<span class="error">âŒ è¯·è¾“å…¥ä»»åŠ¡IDå¹¶ç™»å½•</span>';
                return;
            }
            
            resultDiv.innerHTML = '<span class="loading">ğŸ”„ æ­£åœ¨é¢†å–å¥–åŠ±...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/quests/claim`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ questId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const rewardText = data.data.rewards.map(r => `${r.name}: ${r.amount}`).join(', ');
                    resultDiv.innerHTML = `
                        <div class="success">âœ… ä»»åŠ¡å¥–åŠ±é¢†å–æˆåŠŸï¼</div>
                        <div><strong>ä»»åŠ¡:</strong> ${data.data.questId}</div>
                        <div><strong>å¥–åŠ±:</strong> ${rewardText}</div>
                    `;
                    
                    // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
                    if (currentQuestCategory === 'daily') {
                        loadDailyQuests();
                    } else {
                        loadQuests(currentQuestCategory);
                    }
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ é¢†å–å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        // é¢†å–æˆå°±å¥–åŠ±
        async function testClaimAchievementReward() {
            const achievementId = document.getElementById('rewardAchievementId').value;
            await claimAchievementReward(achievementId);
        }

        async function claimAchievementReward(achievementId) {
            const resultDiv = document.getElementById('reward-result');
            
            if (!achievementId || !authToken) {
                resultDiv.innerHTML = '<span class="error">âŒ è¯·è¾“å…¥æˆå°±IDå¹¶ç™»å½•</span>';
                return;
            }
            
            resultDiv.innerHTML = '<span class="loading">ğŸ”„ æ­£åœ¨é¢†å–å¥–åŠ±...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/achievements/claim`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ achievementId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const rewardText = data.data.rewards.map(r => `${r.name}: ${r.amount}`).join(', ');
                    resultDiv.innerHTML = `
                        <div class="success">âœ… æˆå°±å¥–åŠ±é¢†å–æˆåŠŸï¼</div>
                        <div><strong>æˆå°±:</strong> ${data.data.achievementId}</div>
                        <div><strong>å¥–åŠ±:</strong> ${rewardText}</div>
                        <div><strong>ç§¯åˆ†:</strong> ${data.data.points}</div>
                    `;
                    
                    // åˆ·æ–°æˆå°±åˆ—è¡¨å’Œç»Ÿè®¡
                    loadAchievements(currentAchievementCategory);
                    loadAchievementStatistics();
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ é¢†å–å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        // å¿«æ·æ›´æ–°è¿›åº¦
        async function updateQuestProgress(questId) {
            // æ¨¡æ‹Ÿä»»åŠ¡è¿›åº¦
            const actionMap = {
                'daily_battle': 'battles_completed',
                'daily_upgrade': 'hero_upgrades',
                'daily_arena': 'arena_battles',
                'daily_enhance': 'equipment_enhancements'
            };
            
            const action = actionMap[questId] || 'battles_completed';
            
            try {
                const response = await fetch(`${API_BASE}/quests/progress`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ questId, action, value: 1 })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
                    if (currentQuestCategory === 'daily') {
                        loadDailyQuests();
                    } else {
                        loadQuests(currentQuestCategory);
                    }
                }
            } catch (error) {
                console.error('æ›´æ–°ä»»åŠ¡è¿›åº¦å¤±è´¥:', error);
            }
        }

        // å¿«æ·æ›´æ–°æˆå°±è¿›åº¦
        async function updateAchievementProgress(achievementId) {
            // æ¨¡æ‹Ÿæˆå°±è¿›åº¦
            const actionMap = {
                'first_victory': 'battles_won',
                'hero_collector': 'unique_heroes',
                'friend_maker': 'friends_count',
                'guild_member': 'guild_joined'
            };
            
            const action = actionMap[achievementId] || 'battles_won';
            
            try {
                const response = await fetch(`${API_BASE}/achievements/progress`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ achievementId, action, value: 1 })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // åˆ·æ–°æˆå°±åˆ—è¡¨
                    loadAchievements(currentAchievementCategory);
                    loadAchievementStatistics();
                }
            } catch (error) {
                console.error('æ›´æ–°æˆå°±è¿›åº¦å¤±è´¥:', error);
            }
        }

        // åˆ·æ–°æ¯æ—¥ä»»åŠ¡
        async function refreshDailyQuests() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            // è¿™é‡Œå¯ä»¥å®ç°æ¯æ—¥ä»»åŠ¡é‡ç½®é€»è¾‘
            alert('ğŸ”„ æ¯æ—¥ä»»åŠ¡å·²åˆ·æ–°ï¼ˆæ¨¡æ‹ŸåŠŸèƒ½ï¼‰');
            loadDailyQuests();
        }

        // å·¥å…·å‡½æ•°
        function getStatusText(status) {
            const statusMap = {
                'not_started': 'æœªå¼€å§‹',
                'in_progress': 'è¿›è¡Œä¸­',
                'completed': 'å·²å®Œæˆ',
                'claimed': 'å·²é¢†å–',
                'locked': 'æœªè§£é”',
                'expired': 'å·²è¿‡æœŸ'
            };
            return statusMap[status] || status;
        }

        function getRewardName(rewardType) {
            const rewardNames = {
                gold: 'é‡‘å¸',
                gems: 'å…ƒå®',
                energy: 'ä½“åŠ›',
                honor: 'è£èª‰',
                skill_books: 'æŠ€èƒ½ä¹¦',
                enhancement_stones: 'å¼ºåŒ–çŸ³',
                hero_fragments: 'æ­¦å°†ç¢ç‰‡',
                rare_materials: 'ç¨€æœ‰ææ–™',
                legendary_summon_ticket: 'ä¼ è¯´å¬å”¤åˆ¸',
                awakening_crystals: 'è§‰é†’æ°´æ™¶'
            };
            return rewardNames[rewardType] || rewardType;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ç™»å½•
        window.onload = function() {
            setTimeout(() => {
                testAuth();
            }, 500);
        };
    </script>
</body>
</html>