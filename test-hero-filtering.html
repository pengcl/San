<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¦å°†ç­›é€‰å’Œæ’åºåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { 
            font-family: 'Microsoft YaHei', Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
        }
        .test-section { 
            border: 1px solid #444; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
        }
        .success { color: #4caf50; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
        .loading { color: #ff9800; }
        .info { color: #2196f3; }
        button { 
            padding: 12px 20px; 
            margin: 8px; 
            cursor: pointer; 
            border: none;
            border-radius: 6px;
            background: linear-gradient(45deg, #ff6b35, #f9ca24);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        button:hover { 
            background: linear-gradient(45deg, #ff8c42, #f9d71c);
            transform: translateY(-1px);
        }
        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .filter-control {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,107,53,0.3);
        }
        .hero-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .hero-card {
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }
        .hero-card:hover {
            border-color: #ff6b35;
            background: rgba(255,107,53,0.2);
        }
        .faction-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        .faction-shu { background: #e74c3c; }
        .faction-wei { background: #3498db; }
        .faction-wu { background: #2ecc71; }
        
        .unit-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-left: 5px;
        }
        .unit-æ­¥å…µ { background: #ff5722; }
        .unit-éª‘å…µ { background: #ff9800; }
        .unit-å¼“å…µ { background: #4caf50; }
        
        .stars {
            color: #ffd700;
        }
        h1 { 
            text-align: center; 
            color: #ff6b35; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }
        h3 { color: #ff6b35; border-bottom: 2px solid #ff6b35; padding-bottom: 5px; }
        
        .navigation {
            text-align: center;
            margin: 20px 0;
        }
        .nav-link {
            color: #ff6b35;
            text-decoration: none;
            margin: 0 15px;
            padding: 8px 16px;
            border: 1px solid #ff6b35;
            border-radius: 4px;
            display: inline-block;
            transition: all 0.3s;
        }
        .nav-link:hover {
            background: rgba(255,107,53,0.2);
        }
        
        select, input {
            background: rgba(255,255,255,0.1);
            border: 1px solid #444;
            color: white;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
            margin-top: 5px;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 6px;
            text-align: center;
            min-width: 120px;
        }
    </style>
</head>
<body>
    <h1>ä¸‰å›½è‹±é›„ä¼  - æ­¦å°†ç­›é€‰å’Œæ’åºåŠŸèƒ½æµ‹è¯• ğŸ”</h1>
    
    <div class="navigation">
        <a href="http://localhost:3000" class="nav-link" target="_blank">ğŸ® å‰ç«¯åº”ç”¨</a>
        <a href="http://localhost:3000/heroes" class="nav-link" target="_blank">ğŸ‘¥ æ­¦å°†é¡µé¢</a>
        <a href="test-formation-system.html" class="nav-link">âš”ï¸ é˜µå®¹æµ‹è¯•</a>
        <a href="test-battle-flow.html" class="nav-link">ğŸŸï¸ æˆ˜æ–—æµ‹è¯•</a>
    </div>

    <div class="test-section">
        <h3>1. ç™»å½•æµ‹è¯•</h3>
        <button onclick="testAuth()">ğŸ” ç™»å½•è·å–Token</button>
        <div id="auth-result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. è·å–æ­¦å°†æ•°æ®</h3>
        <button onclick="loadHeroes()">ğŸ‘¥ åŠ è½½æ­¦å°†æ•°æ®</button>
        <div id="load-result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. ç­›é€‰å’Œæ’åºæ§åˆ¶å°</h3>
        
        <div class="filter-controls">
            <div class="filter-control">
                <label>ğŸ” åç§°æœç´¢ï¼š</label>
                <input type="text" id="searchInput" placeholder="è¾“å…¥æ­¦å°†åç§°..." onkeyup="applyFilters()">
            </div>
            
            <div class="filter-control">
                <label>â­ æ˜Ÿçº§ç­›é€‰ï¼š</label>
                <select id="rarityFilter" onchange="applyFilters()">
                    <option value="">å…¨éƒ¨æ˜Ÿçº§</option>
                    <option value="1">1â˜…</option>
                    <option value="2">2â˜…</option>
                    <option value="3">3â˜…</option>
                    <option value="4">4â˜…</option>
                    <option value="5">5â˜…</option>
                    <option value="6">6â˜…</option>
                </select>
            </div>
            
            <div class="filter-control">
                <label>ğŸ¯ é˜µè¥ç­›é€‰ï¼š</label>
                <select id="factionFilter" onchange="applyFilters()">
                    <option value="">å…¨éƒ¨é˜µè¥</option>
                    <option value="èœ€">ğŸ”´ èœ€</option>
                    <option value="é­">ğŸ”µ é­</option>
                    <option value="å´">ğŸŸ¢ å´</option>
                </select>
            </div>
            
            <div class="filter-control">
                <label>âš”ï¸ å…µç§ç­›é€‰ï¼š</label>
                <select id="unitTypeFilter" onchange="applyFilters()">
                    <option value="">å…¨éƒ¨å…µç§</option>
                    <option value="æ­¥å…µ">ğŸ›¡ï¸ æ­¥å…µ</option>
                    <option value="éª‘å…µ">ğŸ éª‘å…µ</option>
                    <option value="å¼“å…µ">ğŸ¹ å¼“å…µ</option>
                </select>
            </div>
            
            <div class="filter-control">
                <label>ğŸ“Š æ’åºæ–¹å¼ï¼š</label>
                <select id="sortBy" onchange="applyFilters()">
                    <option value="power">æˆ˜åŠ›æ’åº</option>
                    <option value="level">ç­‰çº§æ’åº</option>
                    <option value="star">æ˜Ÿçº§æ’åº</option>
                    <option value="attack">æ”»å‡»åŠ›æ’åº</option>
                    <option value="defense">é˜²å¾¡åŠ›æ’åº</option>
                    <option value="speed">é€Ÿåº¦æ’åº</option>
                </select>
            </div>
            
            <div class="filter-control">
                <label>ğŸ”„ æ’åºé¡ºåºï¼š</label>
                <select id="sortOrder" onchange="applyFilters()">
                    <option value="desc">ä»é«˜åˆ°ä½</option>
                    <option value="asc">ä»ä½åˆ°é«˜</option>
                </select>
            </div>
        </div>
        
        <div class="stats-bar" id="filterStats">
            <div class="stat-item">
                <div><strong>æ€»æ­¦å°†</strong></div>
                <div id="totalCount">0</div>
            </div>
            <div class="stat-item">
                <div><strong>ç­›é€‰ç»“æœ</strong></div>
                <div id="filteredCount">0</div>
            </div>
            <div class="stat-item">
                <div><strong>èœ€å›½æ­¦å°†</strong></div>
                <div id="shuCount">0</div>
            </div>
            <div class="stat-item">
                <div><strong>é­å›½æ­¦å°†</strong></div>
                <div id="weiCount">0</div>
            </div>
            <div class="stat-item">
                <div><strong>å´å›½æ­¦å°†</strong></div>
                <div id="wuCount">0</div>
            </div>
        </div>
        
        <button onclick="clearAllFilters()">ğŸ§¹ æ¸…é™¤æ‰€æœ‰ç­›é€‰</button>
        <button onclick="applyFilters()">ğŸ”„ é‡æ–°ç­›é€‰</button>
    </div>

    <div class="test-section">
        <h3>4. æ­¦å°†åˆ—è¡¨</h3>
        <div id="heroesGrid" class="hero-grid">
            <!-- æ­¦å°†å¡ç‰‡å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
        </div>
    </div>

    <div class="test-section">
        <h3>5. å‰ç«¯é›†æˆéªŒè¯</h3>
        <div class="info">
            <p>ğŸ¯ <strong>æµ‹è¯•è¦ç‚¹ï¼š</strong></p>
            <ul>
                <li>éªŒè¯æœç´¢åŠŸèƒ½ï¼šè¾“å…¥æ­¦å°†åç§°å®æ—¶ç­›é€‰</li>
                <li>éªŒè¯æ˜Ÿçº§ç­›é€‰ï¼šæŒ‰1-6æ˜Ÿçº§è¿‡æ»¤</li>
                <li>éªŒè¯é˜µè¥ç­›é€‰ï¼šæŒ‰èœ€ã€é­ã€å´ä¸‰å›½ç­›é€‰</li>
                <li>éªŒè¯å…µç§ç­›é€‰ï¼šæŒ‰æ­¥å…µã€éª‘å…µã€å¼“å…µç­›é€‰</li>
                <li>éªŒè¯æ’åºåŠŸèƒ½ï¼šæŒ‰ä¸åŒå±æ€§å’Œé¡ºåºæ’åº</li>
                <li>éªŒè¯ç»„åˆç­›é€‰ï¼šå¤šä¸ªæ¡ä»¶åŒæ—¶ç­›é€‰</li>
            </ul>
        </div>
        <button onclick="window.open('http://localhost:3000/heroes', '_blank')">ğŸš€ æ‰“å¼€æ­¦å°†é¡µé¢æµ‹è¯•</button>
    </div>

    <script>
        const API_BASE = 'http://localhost:1337/api';
        let authToken = null;
        let allHeroes = [];
        let filteredHeroes = [];

        // è®¤è¯
        async function testAuth() {
            const resultDiv = document.getElementById('auth-result');
            resultDiv.innerHTML = '<span class="loading">ğŸ”„ æ­£åœ¨ç™»å½•...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        identifier: 'pengcl',
                        password: 'zouleyuan',
                        rememberMe: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.data.token) {
                    authToken = data.data.token;
                    resultDiv.innerHTML = `
                        <span class="success">âœ… ç™»å½•æˆåŠŸ</span>
                        <div>ç”¨æˆ·: ${data.data.user.username} | Token: ${authToken.substring(0, 20)}...</div>
                    `;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ç™»å½•å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        // åŠ è½½æ­¦å°†æ•°æ®
        async function loadHeroes() {
            const resultDiv = document.getElementById('load-result');
            
            if (!authToken) {
                resultDiv.innerHTML = '<span class="error">âŒ è¯·å…ˆç™»å½•</span>';
                return;
            }
            
            resultDiv.innerHTML = '<span class="loading">ğŸ”„ æ­£åœ¨åŠ è½½æ­¦å°†æ•°æ®...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/user-heroes?page=1&limit=100`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                const data = await response.json();
                
                if (data.success || data.data) {
                    allHeroes = data.data || [];
                    
                    resultDiv.innerHTML = `
                        <span class="success">âœ… åŠ è½½æˆåŠŸ</span>
                        <div>æ­¦å°†æ•°é‡: ${allHeroes.length}</div>
                    `;
                    
                    updateStatistics();
                    applyFilters();
                    
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ åŠ è½½å¤±è´¥: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</span>`;
            }
        }

        // åº”ç”¨ç­›é€‰å’Œæ’åº
        function applyFilters() {
            if (allHeroes.length === 0) return;
            
            let filtered = [...allHeroes];
            
            // åç§°æœç´¢
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(hero => 
                    hero.name?.toLowerCase().includes(searchTerm)
                );
            }
            
            // æ˜Ÿçº§ç­›é€‰
            const rarityFilter = document.getElementById('rarityFilter').value;
            if (rarityFilter) {
                filtered = filtered.filter(hero => hero.star == rarityFilter);
            }
            
            // é˜µè¥ç­›é€‰
            const factionFilter = document.getElementById('factionFilter').value;
            if (factionFilter) {
                filtered = filtered.filter(hero => hero.faction === factionFilter);
            }
            
            // å…µç§ç­›é€‰
            const unitTypeFilter = document.getElementById('unitTypeFilter').value;
            if (unitTypeFilter) {
                filtered = filtered.filter(hero => hero.unitType === unitTypeFilter);
            }
            
            // æ’åº
            const sortBy = document.getElementById('sortBy').value;
            const sortOrder = document.getElementById('sortOrder').value;
            
            filtered.sort((a, b) => {
                let comparison = 0;
                switch (sortBy) {
                    case 'level':
                        comparison = (a.level || 0) - (b.level || 0);
                        break;
                    case 'star':
                        comparison = (a.star || 0) - (b.star || 0);
                        break;
                    case 'attack':
                        comparison = (a.stats?.attack || 0) - (b.stats?.attack || 0);
                        break;
                    case 'defense':
                        comparison = (a.stats?.defense || 0) - (b.stats?.defense || 0);
                        break;
                    case 'speed':
                        comparison = (a.stats?.speed || 0) - (b.stats?.speed || 0);
                        break;
                    case 'power':
                        comparison = (a.power || 0) - (b.power || 0);
                        break;
                }
                return sortOrder === 'desc' ? -comparison : comparison;
            });
            
            filteredHeroes = filtered;
            displayHeroes();
            updateFilterStats();
        }

        // æ˜¾ç¤ºæ­¦å°†
        function displayHeroes() {
            const grid = document.getElementById('heroesGrid');
            
            if (filteredHeroes.length === 0) {
                grid.innerHTML = '<div style="text-align: center; grid-column: 1/-1;"><h3>ğŸ” æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ­¦å°†</h3></div>';
                return;
            }
            
            grid.innerHTML = filteredHeroes.map(hero => {
                const stars = 'â­'.repeat(hero.star || 1);
                const factionClass = `faction-${hero.faction === 'èœ€' ? 'shu' : hero.faction === 'é­' ? 'wei' : 'wu'}`;
                const unitClass = `unit-${hero.unitType}`;
                
                return `
                    <div class="hero-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong>${hero.name}</strong>
                            <div class="stars">${stars}</div>
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <span class="faction-badge ${factionClass}">${hero.faction}</span>
                            <span class="unit-badge ${unitClass}">${hero.unitType}</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 12px;">
                            <div>ç­‰çº§: ${hero.level}</div>
                            <div>æˆ˜åŠ›: ${hero.power?.toLocaleString()}</div>
                            <div>æ”»å‡»: ${hero.stats?.attack}</div>
                            <div>é˜²å¾¡: ${hero.stats?.defense}</div>
                            <div>é€Ÿåº¦: ${hero.stats?.speed}</div>
                            <div>ç”Ÿå‘½: ${hero.stats?.hp}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatistics() {
            const shuCount = allHeroes.filter(hero => hero.faction === 'èœ€').length;
            const weiCount = allHeroes.filter(hero => hero.faction === 'é­').length;
            const wuCount = allHeroes.filter(hero => hero.faction === 'å´').length;
            
            document.getElementById('totalCount').textContent = allHeroes.length;
            document.getElementById('shuCount').textContent = shuCount;
            document.getElementById('weiCount').textContent = weiCount;
            document.getElementById('wuCount').textContent = wuCount;
        }

        // æ›´æ–°ç­›é€‰ç»Ÿè®¡
        function updateFilterStats() {
            document.getElementById('filteredCount').textContent = filteredHeroes.length;
        }

        // æ¸…é™¤æ‰€æœ‰ç­›é€‰
        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('rarityFilter').value = '';
            document.getElementById('factionFilter').value = '';
            document.getElementById('unitTypeFilter').value = '';
            document.getElementById('sortBy').value = 'power';
            document.getElementById('sortOrder').value = 'desc';
            
            applyFilters();
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ç™»å½•
        window.onload = function() {
            setTimeout(() => {
                testAuth();
            }, 500);
        };
    </script>
</body>
</html>