<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¦å°†ç³»ç»Ÿæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .hero-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: inline-block;
            width: 200px;
            vertical-align: top;
        }
        .hero-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .hero-info {
            font-size: 14px;
            color: #666;
            margin: 4px 0;
        }
        .quality-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
            font-weight: bold;
        }
        .filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .filter-group {
            margin: 10px 0;
        }
        .filter-group label {
            display: inline-block;
            width: 80px;
            font-weight: bold;
        }
        select, input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-left: 10px;
        }
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e55529;
        }
        .stats {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .error {
            color: red;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .loading {
            text-align: center;
            color: #666;
            padding: 40px;
        }
    </style>
</head>
<body>
    <h1>ğŸ® ä¸‰å›½è‹±é›„ä¼  - æ­¦å°†ç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="stats">
        <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
        <div id="systemStatus">æ£€æŸ¥ä¸­...</div>
    </div>

    <div class="filters">
        <h3>ğŸ” ç­›é€‰æ¡ä»¶</h3>
        <div class="filter-group">
            <label>å“è´¨ç­›é€‰:</label>
            <select id="qualityFilter">
                <option value="">å…¨éƒ¨å“è´¨</option>
                <option value="1">1â˜… æ™®é€š</option>
                <option value="2">2â˜… ä¼˜ç§€</option>
                <option value="3">3â˜… ç²¾è‰¯</option>
                <option value="4">4â˜… å²è¯—</option>
                <option value="5">5â˜… ä¼ è¯´</option>
                <option value="6">6â˜… ç¥è¯</option>
            </select>
        </div>
        <div class="filter-group">
            <label>é˜µè¥ç­›é€‰:</label>
            <select id="factionFilter">
                <option value="">å…¨éƒ¨é˜µè¥</option>
                <option value="èœ€">ğŸ”´ èœ€æ±‰</option>
                <option value="é­">ğŸ”µ æ›¹é­</option>
                <option value="å´">ğŸŸ¢ ä¸œå´</option>
                <option value="ç¾¤é›„">ğŸŸ¡ ç¾¤é›„</option>
            </select>
        </div>
        <div class="filter-group">
            <label>æœç´¢:</label>
            <input type="text" id="searchInput" placeholder="è¾“å…¥æ­¦å°†åç§°...">
        </div>
        <div class="filter-group">
            <button onclick="loadHeroes()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            <button onclick="clearFilters()">ğŸ—‘ï¸ æ¸…é™¤ç­›é€‰</button>
            <button onclick="testLogin()">ğŸ”‘ æµ‹è¯•ç™»å½•</button>
        </div>
    </div>

    <div id="heroContainer">
        <div class="loading">æ­£åœ¨åŠ è½½æ­¦å°†æ•°æ®...</div>
    </div>

    <script>
        let allHeroes = [];
        let userToken = null;

        // å“è´¨é¢œè‰²æ˜ å°„
        const qualityColors = {
            1: '#808080', // æ™®é€š
            2: '#00FF00', // ä¼˜ç§€  
            3: '#0080FF', // ç²¾è‰¯
            4: '#8000FF', // å²è¯—
            5: '#FF8000', // ä¼ è¯´
            6: '#FF0000'  // ç¥è¯
        };

        const qualityNames = {
            1: 'æ™®é€š', 2: 'ä¼˜ç§€', 3: 'ç²¾è‰¯', 4: 'å²è¯—', 5: 'ä¼ è¯´', 6: 'ç¥è¯'
        };

        // åˆå§‹åŒ–
        async function init() {
            await checkSystemStatus();
            await testLogin();
            await loadHeroes();
            setupEventListeners();
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        async function checkSystemStatus() {
            const statusEl = document.getElementById('systemStatus');
            try {
                // æ£€æŸ¥åç«¯API
                const response = await fetch('http://localhost:1337/api/heroes?limit=1');
                const backendStatus = response.ok ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸';
                
                // æ£€æŸ¥å‰ç«¯
                const frontendResponse = await fetch('http://localhost:3000');
                const frontendStatus = frontendResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸';
                
                statusEl.innerHTML = `
                    <div>åç«¯API (1337): ${backendStatus}</div>
                    <div>å‰ç«¯é¡µé¢ (3000): ${frontendStatus}</div>
                    <div>æ—¶é—´: ${new Date().toLocaleString()}</div>
                `;
            } catch (error) {
                statusEl.innerHTML = `<div class="error">âŒ ç³»ç»Ÿæ£€æŸ¥å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æµ‹è¯•ç™»å½•
        async function testLogin() {
            try {
                const response = await fetch('http://localhost:1337/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        identifier: 'pengcl',
                        password: 'zouleyuan'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    userToken = data.data.token;
                    console.log('âœ… ç™»å½•æˆåŠŸ');
                    return true;
                } else {
                    console.error('âŒ ç™»å½•å¤±è´¥');
                    return false;
                }
            } catch (error) {
                console.error('âŒ ç™»å½•é”™è¯¯:', error);
                return false;
            }
        }

        // åŠ è½½æ­¦å°†æ•°æ®
        async function loadHeroes() {
            const container = document.getElementById('heroContainer');
            container.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½æ­¦å°†æ•°æ®...</div>';

            try {
                // åŠ è½½æ­¦å°†æ¨¡æ¿æ•°æ®
                const templateResponse = await fetch('http://localhost:1337/api/heroes?limit=20');
                const templateData = await templateResponse.json();
                
                if (templateData.success) {
                    allHeroes = templateData.data.heroes;
                    console.log('âœ… åŠ è½½äº†', allHeroes.length, 'ä¸ªæ­¦å°†æ¨¡æ¿');
                    filterAndDisplayHeroes();
                } else {
                    throw new Error('APIè¿”å›é”™è¯¯: ' + templateData.error?.message);
                }
            } catch (error) {
                container.innerHTML = `<div class="error">âŒ åŠ è½½å¤±è´¥: ${error.message}</div>`;
                console.error('åŠ è½½æ­¦å°†æ•°æ®å¤±è´¥:', error);
            }
        }

        // ç­›é€‰å¹¶æ˜¾ç¤ºæ­¦å°†
        function filterAndDisplayHeroes() {
            const container = document.getElementById('heroContainer');
            const qualityFilter = document.getElementById('qualityFilter').value;
            const factionFilter = document.getElementById('factionFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            let filteredHeroes = [...allHeroes];

            // å“è´¨ç­›é€‰
            if (qualityFilter) {
                filteredHeroes = filteredHeroes.filter(hero => 
                    hero.quality == qualityFilter || hero.rarity == qualityFilter
                );
            }

            // é˜µè¥ç­›é€‰
            if (factionFilter) {
                filteredHeroes = filteredHeroes.filter(hero => 
                    hero.faction === factionFilter
                );
            }

            // æœç´¢ç­›é€‰
            if (searchQuery) {
                filteredHeroes = filteredHeroes.filter(hero =>
                    hero.name.toLowerCase().includes(searchQuery) ||
                    (hero.description && hero.description.toLowerCase().includes(searchQuery))
                );
            }

            // æŒ‰å“è´¨æ’åº
            filteredHeroes.sort((a, b) => (b.quality || b.rarity || 1) - (a.quality || a.rarity || 1));

            // æ˜¾ç¤ºç»“æœ
            if (filteredHeroes.length === 0) {
                container.innerHTML = '<div class="loading">ğŸ˜” æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ­¦å°†</div>';
                return;
            }

            const heroCards = filteredHeroes.map(hero => {
                const quality = hero.quality || hero.rarity || 1;
                const qualityColor = hero.qualityColor || qualityColors[quality] || '#808080';
                const qualityName = hero.qualityName || qualityNames[quality] || 'æœªçŸ¥';
                
                return `
                    <div class="hero-card">
                        <div class="hero-name">${hero.name}</div>
                        <div class="hero-info">
                            <span class="quality-badge" style="background-color: ${qualityColor}">
                                ${quality}â˜… ${qualityName}
                            </span>
                        </div>
                        <div class="hero-info">ğŸ° é˜µè¥: ${hero.faction || 'æœªçŸ¥'}</div>
                        <div class="hero-info">âš”ï¸ å…µç§: ${hero.unitType || 'æœªçŸ¥'}</div>
                        <div class="hero-info">ğŸ’ª æ”»å‡»: ${hero.baseStats?.attack || 'æœªçŸ¥'}</div>
                        <div class="hero-info">ğŸ›¡ï¸ é˜²å¾¡: ${hero.baseStats?.defense || 'æœªçŸ¥'}</div>
                        <div class="hero-info">â¤ï¸ ç”Ÿå‘½: ${hero.baseStats?.hp || 'æœªçŸ¥'}</div>
                        <div class="hero-info">ğŸ’¨ é€Ÿåº¦: ${hero.baseStats?.speed || 'æœªçŸ¥'}</div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <strong>ğŸ“Š æ‰¾åˆ° ${filteredHeroes.length} ä¸ªæ­¦å°† (å…± ${allHeroes.length} ä¸ª)</strong>
                </div>
                ${heroCards}
            `;
        }

        // æ¸…é™¤ç­›é€‰
        function clearFilters() {
            document.getElementById('qualityFilter').value = '';
            document.getElementById('factionFilter').value = '';
            document.getElementById('searchInput').value = '';
            filterAndDisplayHeroes();
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            document.getElementById('qualityFilter').addEventListener('change', filterAndDisplayHeroes);
            document.getElementById('factionFilter').addEventListener('change', filterAndDisplayHeroes);
            document.getElementById('searchInput').addEventListener('input', filterAndDisplayHeroes);
        }

        // åˆå§‹åŒ–åº”ç”¨
        window.addEventListener('load', init);
    </script>
</body>
</html>