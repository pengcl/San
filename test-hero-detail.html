<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¦å°†è¯¦æƒ…é¡µé¢æµ‹è¯•</title>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .hero-detail {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
        }
        .api-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .error {
            color: red;
            background: #ffebee;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success {
            color: green;
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .hero-stat {
            display: inline-block;
            margin: 5px 10px;
            padding: 5px 10px;
            background: #e3f2fd;
            border-radius: 4px;
            font-weight: bold;
        }
        .quality-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            margin: 5px;
        }
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e55529;
        }
    </style>
</head>
<body>
    <h1>ğŸ® æ­¦å°†è¯¦æƒ…é¡µé¢æµ‹è¯•</h1>

    <div class="test-section">
        <h3>ğŸ“Š é€‰æ‹©æµ‹è¯•æ­¦å°†</h3>
        <div>
            <button onclick="testHeroDetail(1001)">åˆ˜å¤‡ (1001)</button>
            <button onclick="testHeroDetail(1002)">è¯¸è‘›äº® (1002)</button>
            <button onclick="testHeroDetail(1003)">å…³ç¾½ (1003)</button>
            <button onclick="testHeroDetail(2001)">æ›¹æ“ (2001)</button>
            <button onclick="testHeroDetail(4004)">å•å¸ƒ (4004)</button>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ”— API æµ‹è¯•ç»“æœ</h3>
        <div id="apiTest">
            <div class="loading">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•æ­¦å°†è¯¦æƒ…API...</div>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ® æ­¦å°†è¯¦æƒ…å±•ç¤º</h3>
        <div id="heroDetail">
            <div class="loading">é€‰æ‹©æ­¦å°†æŸ¥çœ‹è¯¦æƒ…...</div>
        </div>
    </div>

    <div class="test-section">
        <h3>ğŸ§ª å‰ç«¯é¡µé¢è®¿é—®æµ‹è¯•</h3>
        <div>
            <p>ç‚¹å‡»ä»¥ä¸‹é“¾æ¥æµ‹è¯•å‰ç«¯æ­¦å°†è¯¦æƒ…é¡µé¢ï¼š</p>
            <a href="http://localhost:3000/heroes/1001" target="_blank">åˆ˜å¤‡è¯¦æƒ…é¡µé¢</a> |
            <a href="http://localhost:3000/heroes/1002" target="_blank">è¯¸è‘›äº®è¯¦æƒ…é¡µé¢</a> |
            <a href="http://localhost:3000/heroes/2001" target="_blank">æ›¹æ“è¯¦æƒ…é¡µé¢</a> |
            <a href="http://localhost:3000/heroes/4004" target="_blank">å•å¸ƒè¯¦æƒ…é¡µé¢</a>
        </div>
    </div>

    <script>
        // æµ‹è¯•æ­¦å°†è¯¦æƒ…API
        async function testHeroDetail(heroId) {
            const apiContainer = document.getElementById('apiTest');
            const detailContainer = document.getElementById('heroDetail');
            
            apiContainer.innerHTML = '<div class="loading">æ­£åœ¨æµ‹è¯•æ­¦å°†è¯¦æƒ…API...</div>';
            detailContainer.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½æ­¦å°†è¯¦æƒ…...</div>';

            try {
                const response = await fetch(`http://localhost:1337/api/heroes/${heroId}`);
                const data = await response.json();

                if (data.success) {
                    const hero = data.data;
                    
                    // æ˜¾ç¤ºAPIå“åº”
                    let apiHtml = `<div class="success">âœ… API æµ‹è¯•æˆåŠŸï¼</div>`;
                    apiHtml += `<div class="api-result">å“åº”æ•°æ®:\n${JSON.stringify(hero, null, 2)}</div>`;
                    apiContainer.innerHTML = apiHtml;

                    // æ˜¾ç¤ºæ­¦å°†è¯¦æƒ…
                    displayHeroDetail(hero);
                } else {
                    throw new Error(data.error?.message || 'API è¿”å›é”™è¯¯');
                }
            } catch (error) {
                apiContainer.innerHTML = `<div class="error">âŒ API æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                detailContainer.innerHTML = `<div class="error">âŒ åŠ è½½æ­¦å°†è¯¦æƒ…å¤±è´¥</div>`;
            }
        }

        // æ˜¾ç¤ºæ­¦å°†è¯¦æƒ…
        function displayHeroDetail(hero) {
            const container = document.getElementById('heroDetail');
            
            // è®¡ç®—æˆ˜åŠ›
            const power = Math.floor(
                (hero.base_attack || hero.baseStats?.attack || 0) +
                (hero.base_defense || hero.baseStats?.defense || 0) +
                (hero.base_hp || hero.baseStats?.hp || 0) / 10 +
                (hero.base_speed || hero.baseStats?.speed || 0)
            );
            
            const html = `
                <div class="hero-detail">
                    <h2>${hero.name} ${hero.title ? '- ' + hero.title : ''}</h2>
                    
                    <div class="quality-badge" style="background-color: ${hero.qualityColor || '#808080'}">
                        ${hero.quality || 1}â˜… ${hero.qualityName || 'æœªçŸ¥'}
                    </div>
                    
                    <p><strong>æè¿°ï¼š</strong>${hero.description || 'æš‚æ— æè¿°'}</p>
                    
                    <div style="margin: 15px 0;">
                        <span class="hero-stat">ğŸ° é˜µè¥: ${hero.faction || 'æœªçŸ¥'}</span>
                        <span class="hero-stat">âš”ï¸ å…µç§: ${hero.unitType || 'æœªçŸ¥'}</span>
                        <span class="hero-stat">âš¡ æˆ˜åŠ›: ${power.toLocaleString()}</span>
                    </div>
                    
                    <h4>åŸºç¡€å±æ€§</h4>
                    <div style="margin: 10px 0;">
                        <span class="hero-stat">â¤ï¸ ç”Ÿå‘½: ${(hero.base_hp || hero.baseStats?.hp || 0).toLocaleString()}</span>
                        <span class="hero-stat">âš”ï¸ æ”»å‡»: ${hero.base_attack || hero.baseStats?.attack || 0}</span>
                        <span class="hero-stat">ğŸ›¡ï¸ é˜²å¾¡: ${hero.base_defense || hero.baseStats?.defense || 0}</span>
                        <span class="hero-stat">ğŸ’¨ é€Ÿåº¦: ${hero.base_speed || hero.baseStats?.speed || 0}</span>
                    </div>
                    
                    <h4>å…¶ä»–ä¿¡æ¯</h4>
                    <div style="margin: 10px 0;">
                        <span class="hero-stat">ç­‰çº§: ${hero.level || 1}</span>
                        <span class="hero-stat">ç»éªŒ: ${hero.experience || 0}</span>
                        <span class="hero-stat">è´¹ç”¨: ${Math.floor((hero.base_attack || hero.baseStats?.attack || 400) / 200) + 3}</span>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // åˆå§‹åŒ–ï¼šè‡ªåŠ¨æµ‹è¯•åˆ˜å¤‡
        document.addEventListener('DOMContentLoaded', function() {
            testHeroDetail(1001);
        });
    </script>
</body>
</html>